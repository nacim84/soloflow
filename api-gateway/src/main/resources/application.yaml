claudeserver:
  port: 8080
  tomcat:
    threads:
      max: 200
    connection-timeout: 20000ms

spring:
  application:
    name: api-gateway

  # Database configuration (can be overridden by profile-specific files)
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5434/soloflow_db}
    username: ${DATABASE_USERNAME:postgres}
    password: ${DATABASE_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: none
      naming:
        # CRITICAL: Keep column names as-is (camelCase) to match Drizzle schema
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        # Disable auto quoting of identifiers
        globally_quoted_identifiers: true

  cloud:
    gateway:
      mvc:
        routes:
          # API Template Service (Timesheet & Mileage)
          - id: api-template
            uri: ${SERVICE_TEMPLATE_URL:http://host.docker.internal:8081}
            predicates:
              - Path=/api/v1/template/**
          # API PDF Service
          - id: api-pdf
            uri: ${SERVICE_PDF_URL:http://host.docker.internal:8082}
            predicates:
              - Path=/api/v1/pdf/**
          # API Docling Service
          - id: api-docling
            uri: ${SERVICE_DOCLING_URL:http://host.docker.internal:8083}
            predicates:
              - Path=/api/v1/docling/**
        default-filters:
          - name: RequestRateLimiter
            args:
              redis-rate-limiter.replenishRate: 100
              redis-rate-limiter.burstCapacity: 200
              key-resolver: "#{@userKeyResolver}"

  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=1000,expireAfterWrite=1h

  # Redis configuration for distributed rate limiting
  data:
    redis:
      host: ${SPRING_DATA_REDIS_HOST:localhost}
      port: ${SPRING_DATA_REDIS_PORT:6379}

management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
    info:
      enabled: true

# API Key Configuration
api:
  key:
    pepper: ${API_KEY_PEPPER:dev-pepper-change-in-production}
